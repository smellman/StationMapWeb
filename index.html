<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://rmap.ekispert.jp/production/rosen.css" />
    <script src="https://rmap.ekispert.jp/production/rosen.js"></script>
    <style>
    body {
      margin: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    </style>
  </head>
  <div id="map"></div>
  <script>
  var rosen;
  function init(api_key) {
    rosen = new Rosen("map", {
      apiKey: api_key,
    })
    rosen.on('selectStation', (data) => {
      if (data.stations.length > 0) {
        const station = data.stations[0]
        rosen.setStationMarker(station.code)
        const ret = {
          code: station.code,
          name: station.name,
        }
        window.postMessage(JSON.stringify(ret))
      }
    })
  }
  document.addEventListener('message', (event) => {
    if (event && event.data) {
      try {
        data = JSON.parse(event.data)
        if (data.type == "init_map") {
          init(data.api_key)
        }
      } catch (e) {
        console.log('invalid json')
      }
    }
  })
  </script>
</html>
